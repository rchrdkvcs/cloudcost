# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a monorepo combining AdonisJS 6 (backend API) and Nuxt 4 (frontend) using Bun as the package manager and runtime. The project uses **Tuyau** for type-safe API communication between frontend and backend.

## Monorepo Structure

```
aduxt/
├── apps/
│   ├── api/          # AdonisJS 6 backend (@aduxt/api)
│   └── web/          # Nuxt 4 frontend (@aduxt/web)
└── packages/         # Shared packages (currently empty)
```

## Development Commands

### Start development servers
```bash
# Start both API and web servers concurrently
bun run dev

# Start API only (runs on http://localhost:3333)
bun run dev:api

# Start web only (runs on http://localhost:3000)
bun run dev:web
```

### API (AdonisJS) commands
```bash
cd apps/api

# Development with HMR
bun run dev

# Run tests
bun run test

# Run specific test suite
node ace test unit
node ace test functional

# Build for production
bun run build

# Type checking
bun run typecheck

# Linting and formatting
bun run lint
bun run format

# Database migrations
node ace migration:run
node ace migration:rollback

# Generate Tuyau API types (auto-generated during dev)
node ace tuyau:generate
```

### Web (Nuxt) commands
```bash
cd apps/web

# Development server
bun run dev

# Build for production
bun run build

# Preview production build
bun run preview
```

## Architecture

### Type-Safe API Communication with Tuyau

This project uses **Tuyau** for end-to-end type safety between AdonisJS and Nuxt:

1. **API exports types**: The AdonisJS app exports its API definition at `@aduxt/api/api`
2. **Nuxt imports types**: The web app imports `@aduxt/api` as a workspace dependency
3. **Tuyau client**: Configured in `apps/web/app/plugins/tuyau.ts` to create a type-safe client
4. **Composable**: `useTuyau()` composable provides typed access to the API client

**Example usage in Nuxt:**
```typescript
const tuyau = useTuyau()
const { data } = await useFetch(tuyau.$url("health"))
```

The API types are automatically generated by Tuyau when the AdonisJS server runs in development mode.

### AdonisJS Structure

- **Routes**: Defined in `start/routes.ts`
- **Path aliases**: Uses import aliases (`#controllers/*`, `#models/*`, etc.) defined in `package.json` imports field
- **Database**: PostgreSQL with Lucid ORM
- **Auth**: Session-based authentication with `@adonisjs/auth`
- **Validation**: VineJS for request validation
- **HMR**: Hot module reloading enabled for controllers and middleware

### Nuxt Structure

- **Styling**: TailwindCSS v4 + Nuxt UI
- **App entry**: `app/app.vue`
- **Type-safe API**: Tuyau client configured for type-safe backend communication
- **Composables**: Located in `app/composables/`
- **Plugins**: Located in `app/plugins/`

## Key Configuration Files

- `package.json` (root): Workspace configuration and dev scripts
- `apps/api/adonisrc.ts`: AdonisJS configuration, providers, and commands
- `apps/api/start/routes.ts`: API route definitions
- `apps/web/nuxt.config.ts`: Nuxt configuration
- `apps/web/app/plugins/tuyau.ts`: Tuyau client setup

## Important Notes

- **Tuyau dependency**: The web app depends on `@aduxt/api` workspace package for type definitions
- **API URL**: Hardcoded to `http://localhost:3333` in Tuyau client configuration
- **Test suites**: API has separate `unit` and `functional` test suites with different timeouts
- **Database**: Requires PostgreSQL connection (check `.env` for configuration)